<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Gordijnen: still → gif → reveal</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
  *{ box-sizing:border-box; }

  body{
    margin:0;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#f4f1ff;
    font-family:system-ui, sans-serif;
  }

  .stage{
    width:360px;
    aspect-ratio:498 / 286; /* originele verhouding */
    position:relative;
    border-radius:24px;
    overflow:hidden;
    background:#fff;
    box-shadow:0 10px 25px rgba(0,0,0,.15);
  }

  /* Cijfer achter alles */
  .digit{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:140px;
    font-weight:800;
    color:#333;
    z-index:1;
  }

  .curtain-layer{
    position:absolute;
    inset:0;
    pointer-events:none;
  }

  /* Still laag */
  .curtain-still{
    z-index:5;
    opacity:1;
    transition:opacity .12s linear;
    will-change:opacity;
  }
  .curtain-still.off{ opacity:0; }

  /* GIF laag */
  .curtain-anim{
    z-index:6;
    opacity:0;
    transition:opacity .08s linear;
    will-change:opacity;
  }
  .curtain-anim.on{ opacity:1; }

  .curtain-layer img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  .controls{
    margin-top:16px;
    display:flex;
    gap:10px;
    justify-content:center;
  }

  button{
    padding:12px 18px;
    font-size:16px;
    border-radius:12px;
    border:none;
    background:#ff8a65;
    color:#fff;
    cursor:pointer;
  }
  button.secondary{ background:#7c8cff; }
</style>
</head>

<body>
<div>
  <div class="stage">
    <div class="digit" id="digit">5</div>

    <!-- STILL (dicht) -->
    <div class="curtain-layer curtain-still" id="still">
      <img src="gordijnen_still.png" alt="">
    </div>

    <!-- GIF (openen) -->
    <div class="curtain-layer curtain-anim" id="anim">
      <img id="gif" src="gordijnen_openen.gif" alt="">
    </div>
  </div>

  <div class="controls">
    <button id="openBtn">Open</button>
    <button class="secondary" id="closeBtn">Volgende ronde</button>
  </div>
</div>

<script>
  const still = document.getElementById("still");
  const anim  = document.getElementById("anim");
  const gifEl = document.getElementById("gif");

  // Zet dit op de echte duur van je GIF (in ms)
  const GIF_DURATION_MS = 1400;

  let busy = false;

  function preload(url){
    return new Promise((resolve)=>{
      const img = new Image();
      img.onload = () => resolve();
      img.onerror = () => resolve();
      img.src = url;
    });
  }

  async function openCurtains(){
    if (busy) return;
    busy = true;

    // 1) Zorg dat de still al zichtbaar is (dicht)
    still.classList.remove("off");

    // 2) Preload GIF om flits te voorkomen
    await preload("gordijnen_openen.gif");

    // 3) Herstart GIF (cache-bust)
    const src = "gordijnen_openen.gif?t=" + Date.now();
    gifEl.onload = () => {
      // 4) Toon GIF bovenop still
      anim.classList.add("on");

      // 5) Na afloop: verberg GIF én still → cijfer zichtbaar
      setTimeout(() => {
        anim.classList.remove("on"); // gif weg
        still.classList.add("off");  // still ook weg => reveal
        busy = false;
      }, GIF_DURATION_MS);
    };
    gifEl.src = src;
  }

  function closeForNextRound(){
    // “Gordijnen weer dicht” voor nieuwe opdracht
    anim.classList.remove("on");
    still.classList.remove("off");
  }

  document.getElementById("openBtn").addEventListener("click", openCurtains);
  document.getElementById("closeBtn").addEventListener("click", closeForNextRound);
</script>
</body>
</html>
